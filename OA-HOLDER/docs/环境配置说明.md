# 环境配置说明

本项目支持三套环境配置：开发/测试环境、RE环境、生产环境。

## 环境文件

- `.env.development` - 开发/测试环境配置
- `.env.re` - RE预发布环境配置
- `.env.production` - 生产环境配置

## 环境变量说明

所有环境变量必须以 `VITE_` 开头才能在渲染进程中使用。

### 常用环境变量

- `VITE_APP_ENV` - 环境标识（development/re/production）
- `VITE_APP_TITLE` - 应用标题
- `VITE_API_BASE_URL` - API 基础地址
- `VITE_WS_URL` - WebSocket 地址
- `VITE_DEBUG` - 是否开启调试模式（true/false）

## 使用方法

### 1. 开发环境（本地开发）

```bash
npm run dev
```

自动使用 `.env.development` 配置。

### 2. 构建 RE 环境包

```bash
# 构建 RE 环境
npm run build:re

# 打包 RE 环境 Windows 安装包
npm run dist:re              # 所有平台
npm run dist:re:win          # Windows 32位和64位
npm run dist:re:win64        # 64位
npm run dist:re:win32        # 32位
```

**输出目录**：`release/v{version}/`（例如：`release/v1.0.1/`）

### 3. 构建生产环境包

```bash
# 构建生产环境
npm run build:prod

# 打包生产环境 Windows 安装包
npm run dist                 # 所有平台
npm run dist:win             # Windows 32位和64位
npm run dist:win64           # 64位
npm run dist:win32           # 32位
```

**输出目录**：`release/v{version}/`（例如：`release/v1.0.1/`）

### 版本号文件夹管理

所有打包命令都会自动根据 `package.json` 中的版本号创建对应的输出文件夹：
- 版本 `1.0.0` → `release/v1.0.0/`
- 版本 `1.0.1` → `release/v1.0.1/`

每次打包都会创建新的版本文件夹，不会覆盖之前的版本。详见 [构建指南](./构建指南.md#版本号管理)。

## 在代码中使用环境配置

### 方式一：使用环境配置模块（推荐）

```typescript
import envConfig, { isDevelopment, isRe, isProduction } from '@/config/env';

// 获取配置
console.log(envConfig.apiBaseUrl);
console.log(envConfig.title);

// 判断环境
if (isDevelopment()) {
  console.log('开发环境');
}

if (isRe()) {
  console.log('RE环境');
}

if (isProduction()) {
  console.log('生产环境');
}
```

### 方式二：直接使用 Vite 环境变量

```typescript
// 直接访问环境变量
const apiUrl = import.meta.env.VITE_API_BASE_URL;
const isDev = import.meta.env.VITE_APP_ENV === 'development';
```

## API 请求工具

项目提供了基于环境配置的请求工具：

```typescript
import request from '@/utils/request';

// GET 请求
const data = await request.get('/api/users', { page: 1 });

// POST 请求
const result = await request.post('/api/users', { name: 'John' });
```

请求工具会自动使用当前环境的 `VITE_API_BASE_URL` 配置。

## 注意事项

1. **环境变量命名**：必须以 `VITE_` 开头才能在渲染进程中使用
2. **RE 环境特殊处理**：Vite 默认只支持 `development` 和 `production`，RE 环境通过特殊配置实现
3. **敏感信息**：不要将敏感信息（如密钥）提交到代码仓库，使用 `.env.local` 文件（已添加到 .gitignore）
4. **环境变量修改**：修改环境变量后需要重启开发服务器或重新构建

## 添加新的环境变量

1. 在对应的 `.env.*` 文件中添加变量：
   ```
   VITE_NEW_VAR=value
   ```

2. 在 `src/renderer/types/env.d.ts` 中添加类型定义：
   ```typescript
   interface ImportMetaEnv {
     readonly VITE_NEW_VAR: string;
   }
   ```

3. 在 `src/renderer/config/env.ts` 中添加配置项（可选）：
   ```typescript
   interface EnvConfig {
     newVar: string;
   }
   
   const config: EnvConfig = {
     newVar: import.meta.env.VITE_NEW_VAR || '',
   };
   ```

