# Electron + React + TypeScript + Ant Design 项目搭建指南

## 项目概述
本指南将帮助您搭建一个基于 Electron、React、TypeScript 和 Ant Design 的桌面应用程序项目。

## 版本信息（基于最新稳定版本）
- **Electron**: v28.x / v29.x（最新稳定版）
- **React**: v18.x（最新稳定版）
- **TypeScript**: v5.x（最新稳定版）
- **Ant Design**: v5.x（最新稳定版）
- **Node.js**: v18.x 或 v20.x LTS

---

## 一、项目初始化

### 1.1 创建项目目录结构
```
OA-HOLDER/
├── package.json
├── tsconfig.json
├── tsconfig.node.json
├── vite.config.ts (或 webpack.config.js)
├── electron-builder.yml (可选)
├── .gitignore
├── README.md
├── src/
│   ├── main/              # Electron 主进程代码
│   │   ├── index.ts
│   │   └── preload.ts
│   ├── renderer/          # React 渲染进程代码
│   │   ├── App.tsx
│   │   ├── main.tsx
│   │   ├── index.html
│   │   ├── components/
│   │   ├── pages/
│   │   └── styles/
│   └── shared/            # 共享类型定义
│       └── types/
└── dist/                  # 构建输出目录
```

### 1.2 初始化 npm 项目
```bash
npm init -y
```

---

## 二、安装依赖

### 2.1 安装 Electron 相关依赖
```bash
# Electron 核心包
npm install --save-dev electron

# Electron 构建工具（可选）
npm install --save-dev electron-builder
# 或
npm install --save-dev electron-forge
```

### 2.2 安装 React 相关依赖
```bash
# React 核心
npm install react react-dom

# React 类型定义
npm install --save-dev @types/react @types/react-dom
```

### 2.3 安装 TypeScript 相关依赖
```bash
# TypeScript
npm install --save-dev typescript

# TypeScript 类型定义
npm install --save-dev @types/node
```

### 2.4 安装 Ant Design
```bash
# Ant Design
npm install antd

# Ant Design 图标库（推荐）
npm install @ant-design/icons
```

### 2.5 安装构建工具（选择其一）

**选项 A: Vite（推荐，更快）**
```bash
npm install --save-dev vite @vitejs/plugin-react
npm install --save-dev electron-vite (可选，专门为 Electron 优化的 Vite)
```

**选项 B: Webpack**
```bash
npm install --save-dev webpack webpack-cli webpack-dev-server
npm install --save-dev html-webpack-plugin ts-loader css-loader style-loader
npm install --save-dev @types/webpack-env
```

### 2.6 安装开发工具
```bash
# 开发依赖
npm install --save-dev concurrently wait-on cross-env
npm install --save-dev nodemon (如果使用 webpack)
```

---

## 三、配置文件设置

### 3.1 package.json 配置

需要配置以下字段：
- `main`: Electron 主进程入口文件
- `scripts`: 开发、构建、打包脚本
- `homepage`: 静态资源路径（如果使用 React Router）

示例 scripts：
```json
{
  "scripts": {
    "dev": "concurrently \"npm run dev:renderer\" \"wait-on http://localhost:5173 && npm run dev:electron\"",
    "dev:renderer": "vite",
    "dev:electron": "cross-env NODE_ENV=development electron .",
    "build": "npm run build:renderer && npm run build:electron",
    "build:renderer": "vite build",
    "build:electron": "tsc -p tsconfig.node.json",
    "preview": "vite preview",
    "pack": "electron-builder",
    "dist": "npm run build && electron-builder"
  }
}
```

### 3.2 tsconfig.json 配置

需要创建两个 TypeScript 配置文件：

**tsconfig.json** (用于渲染进程)
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "forceConsistentCasingInFileNames": true
  },
  "include": ["src/renderer"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

**tsconfig.node.json** (用于主进程)
```json
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "target": "ES2020",
    "lib": ["ES2020"],
    "types": ["node"]
  },
  "include": ["src/main"]
}
```

### 3.3 Vite 配置 (vite.config.ts)

如果使用 Vite：
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  base: './',
  build: {
    outDir: 'dist/renderer',
    emptyOutDir: true
  },
  server: {
    port: 5173
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src/renderer')
    }
  }
})
```

### 3.4 Webpack 配置 (webpack.config.js)

如果使用 Webpack：
```javascript
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  mode: 'development',
  entry: './src/renderer/main.tsx',
  target: 'electron-renderer',
  devtool: 'source-map',
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        use: 'ts-loader',
        exclude: /node_modules/,
      },
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader'],
      },
    ],
  },
  resolve: {
    extensions: ['.tsx', '.ts', '.js'],
  },
  output: {
    filename: 'renderer.js',
    path: path.resolve(__dirname, 'dist/renderer'),
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/renderer/index.html',
    }),
  ],
};
```

---

## 四、创建核心文件

### 4.1 Electron 主进程文件 (src/main/index.ts)

```typescript
import { app, BrowserWindow } from 'electron';
import * as path from 'path';

const isDev = process.env.NODE_ENV === 'development';

function createWindow() {
  const mainWindow = new BrowserWindow({
    width: 1200,
    height: 800,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js'),
      nodeIntegration: false,
      contextIsolation: true,
    },
  });

  if (isDev) {
    mainWindow.loadURL('http://localhost:5173');
    mainWindow.webContents.openDevTools();
  } else {
    mainWindow.loadFile(path.join(__dirname, '../renderer/index.html'));
  }
}

app.whenReady().then(() => {
  createWindow();

  app.on('activate', () => {
    if (BrowserWindow.getAllWindows().length === 0) {
      createWindow();
    }
  });
});

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit();
  }
});
```

### 4.2 Preload 脚本 (src/main/preload.ts)

```typescript
import { contextBridge, ipcRenderer } from 'electron';

// 暴露受保护的方法给渲染进程
contextBridge.exposeInMainWorld('electronAPI', {
  // 示例：获取版本信息
  getVersion: () => ipcRenderer.invoke('get-version'),
  
  // 可以添加更多 API
});
```

### 4.3 React 入口文件 (src/renderer/main.tsx)

```typescript
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import 'antd/dist/reset.css'; // Ant Design 5.x 使用 reset.css

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

### 4.4 React App 组件 (src/renderer/App.tsx)

```typescript
import React from 'react';
import { Button, Layout, Typography } from 'antd';

const { Header, Content } = Layout;
const { Title } = Typography;

const App: React.FC = () => {
  return (
    <Layout style={{ minHeight: '100vh' }}>
      <Header style={{ background: '#001529', padding: '0 24px' }}>
        <Title level={3} style={{ color: '#fff', margin: '16px 0' }}>
          Electron + React + Ant Design
        </Title>
      </Header>
      <Content style={{ padding: '24px' }}>
        <Button type="primary">Hello Electron!</Button>
      </Content>
    </Layout>
  );
};

export default App;
```

### 4.5 HTML 模板 (src/renderer/index.html)

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OA-HOLDER</title>
</head>
<body>
  <div id="root"></div>
  <script type="module" src="/main.tsx"></script>
</body>
</html>
```

---

## 五、类型定义

### 5.1 扩展 Window 类型 (src/renderer/types/electron.d.ts)

```typescript
export interface ElectronAPI {
  getVersion: () => Promise<string>;
}

declare global {
  interface Window {
    electronAPI: ElectronAPI;
  }
}
```

---

## 六、Ant Design 配置

### 6.1 主题定制（可选）

创建 `src/renderer/styles/theme.ts`：
```typescript
import { theme } from 'antd';

export const antdTheme = {
  algorithm: theme.defaultAlgorithm,
  token: {
    colorPrimary: '#1890ff',
  },
};
```

在 App.tsx 中使用：
```typescript
import { ConfigProvider } from 'antd';
import { antdTheme } from './styles/theme';

<ConfigProvider theme={antdTheme}>
  {/* 你的应用内容 */}
</ConfigProvider>
```

### 6.2 国际化配置（可选）

```bash
npm install antd dayjs
```

```typescript
import zhCN from 'antd/locale/zh_CN';
import dayjs from 'dayjs';
import 'dayjs/locale/zh-cn';

dayjs.locale('zh-cn');

<ConfigProvider locale={zhCN}>
  {/* 你的应用内容 */}
</ConfigProvider>
```

---

## 七、构建和打包配置

### 7.1 Electron Builder 配置 (electron-builder.yml)

```yaml
appId: com.yourcompany.oaholder
productName: OA-HOLDER
directories:
  output: release
files:
  - dist/**/*
  - package.json
win:
  target:
    - nsis
    - portable
  icon: build/icon.ico
mac:
  target:
    - dmg
  icon: build/icon.icns
linux:
  target:
    - AppImage
    - deb
  icon: build/icon.png
```

### 7.2 更新 package.json 添加 build 配置

```json
{
  "build": {
    "appId": "com.yourcompany.oaholder",
    "productName": "OA-HOLDER",
    "directories": {
      "output": "release"
    },
    "files": [
      "dist/**/*",
      "package.json"
    ],
    "win": {
      "target": ["nsis", "portable"]
    }
  }
}
```

---

## 八、.gitignore 配置

```
# Dependencies
node_modules/
package-lock.json
yarn.lock

# Build outputs
dist/
release/
out/

# Environment variables
.env
.env.local

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Logs
*.log
npm-debug.log*

# Electron
*.asar

# Temporary build config
electron-builder.temp.json
```

---

## 九、开发流程

### 9.1 开发模式
```bash
npm run dev
```
这将同时启动：
- Vite 开发服务器（渲染进程）
- Electron 应用（主进程）

### 9.2 构建生产版本
```bash
npm run build
```

### 9.3 打包应用

#### 生产环境打包
```bash
npm run dist              # 打包所有平台
npm run dist:win          # 打包 Windows 32位和64位
npm run dist:win32        # 仅打包 Windows 32位
npm run dist:win64        # 仅打包 Windows 64位
```

#### RE 环境打包
```bash
npm run dist:re           # 打包所有平台（RE环境）
npm run dist:re:win       # 打包 Windows（RE环境）
npm run dist:re:win32     # 仅打包 Windows 32位（RE环境）
npm run dist:re:win64     # 仅打包 Windows 64位（RE环境）
```

**版本号文件夹管理：**
打包时会自动根据 `package.json` 中的版本号创建输出文件夹：
- 版本 `1.0.0` → 输出到 `release/v1.0.0/`
- 版本 `1.0.1` → 输出到 `release/v1.0.1/`

每次打包都会创建新的版本文件夹，不会覆盖之前的版本。

---

## 十、安全检查配置

### 10.1 启用上下文隔离
- ✅ 已在主进程中设置 `contextIsolation: true`
- ✅ 已在主进程中设置 `nodeIntegration: false`
- ✅ 使用 preload 脚本进行安全的 IPC 通信

### 10.2 Content Security Policy（可选）

在 index.html 中添加：
```html
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
```

---

## 十一、常见问题和解决方案

### 11.1 Electron 下载慢
设置镜像源（已在 exe.text 中看到）：
```bash
# Windows PowerShell
$env:ELECTRON_MIRROR="https://npmmirror.com/mirrors/electron/"

# 或在 .npmrc 文件中
electron_mirror=https://npmmirror.com/mirrors/electron/
```

### 11.2 路径问题
- 使用 `path.join()` 而不是字符串拼接
- 区分开发和生产环境的路径

### 11.3 热更新
- 开发环境：Vite 自动支持 HMR
- 生产环境：需要手动实现更新机制（可使用 electron-updater）

---

## 十二、可选增强功能

### 12.1 状态管理
```bash
npm install zustand
# 或
npm install @reduxjs/toolkit react-redux
```

### 12.2 路由
```bash
npm install react-router-dom
npm install --save-dev @types/react-router-dom
```

### 12.3 代码格式化
```bash
npm install --save-dev prettier eslint
npm install --save-dev @typescript-eslint/parser @typescript-eslint/eslint-plugin
npm install --save-dev eslint-plugin-react eslint-plugin-react-hooks
```

### 12.4 测试框架
```bash
npm install --save-dev vitest @testing-library/react
```

---

## 十三、项目检查清单

- [ ] 初始化 npm 项目
- [ ] 安装所有依赖包
- [ ] 创建项目目录结构
- [ ] 配置 TypeScript（tsconfig.json, tsconfig.node.json）
- [ ] 配置构建工具（Vite 或 Webpack）
- [ ] 创建 Electron 主进程文件
- [ ] 创建 Preload 脚本
- [ ] 创建 React 应用入口和组件
- [ ] 配置 Ant Design
- [ ] 设置开发脚本
- [ ] 配置构建和打包
- [ ] 创建 .gitignore
- [ ] 测试开发环境
- [ ] 测试生产构建
- [ ] 测试应用打包

---

## 十四、参考资源

- [Electron 官方文档](https://www.electronjs.org/docs)
- [React 官方文档](https://react.dev/)
- [TypeScript 官方文档](https://www.typescriptlang.org/docs/)
- [Ant Design 官方文档](https://ant.design/docs/react/introduce-cn)
- [Vite 官方文档](https://vitejs.dev/)
- [Electron Builder 文档](https://www.electron.build/)

---

## 注意事项

1. **安全性**：始终使用 `contextIsolation: true` 和 `nodeIntegration: false`
2. **性能**：生产环境记得禁用 DevTools
3. **打包大小**：使用 electron-builder 的压缩选项
4. **跨平台**：测试 Windows、macOS、Linux 三个平台
5. **更新机制**：考虑集成 electron-updater 实现自动更新

---

**文档生成时间**: 2024年
**适用版本**: Electron 28+/29+, React 18+, TypeScript 5+, Ant Design 5+

